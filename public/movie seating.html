<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movie Seating Picker</title>
  <style>
    :root{
      --bg:#0f1222;        /* app background */
      --panel:#151835;     /* cards/panels */
      --muted:#8a8fb3;     /* secondary text */
      --text:#e9ecff;      /* primary text */
      --accent:#7aa2ff;    /* interactive */
      --accent-2:#49d6a7;  /* success */
      --danger:#ff6b7a;    /* occupied */
      --warning:#ffd166;   /* reserved */
      --seat:#1b1e3f;      /* seat bg */
      --seat-hover:#2a2f61;
      --seat-selected:#7aa2ff33;
      --gap:14px;
      --radius:16px;
    }

    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 70% -10%, #1a1f44 0%, #0f1222 60%);
      color:var(--text); display:grid; place-items:start center;
    }

    .wrap{ width:min(1100px, 96vw); padding:24px 16px 40px; }

    header{ display:flex; flex-wrap:wrap; align-items:center; gap:8px 16px; justify-content:space-between; margin-bottom:16px; }
    .title{ font-size:clamp(20px, 2.2vw + 14px, 36px); font-weight:700; letter-spacing:.3px }
    .sub{ color:var(--muted); font-weight:500 }

    .panel{
      background:linear-gradient(180deg, #1a1d3d 0%, var(--panel) 100%);
      border:1px solid #272a55; border-radius:var(--radius); box-shadow:0 10px 30px #0006; overflow:hidden;
    }

    .grid-wrap{ padding:18px; }
    .screen{ height:10px; border-radius:999px; background:linear-gradient(90deg, #99a7ff 0, #fff 50%, #99a7ff 100%); filter: drop-shadow(0 10px 6px #99a7ff33); margin:20px auto 26px; width:min(640px, 85%); }
    .screen-label{ text-align:center; color:var(--muted); font-size:13px; margin-top:-12px; margin-bottom:10px; letter-spacing:.12em }

    .legend{ display:flex; align-items:center; gap:14px; flex-wrap:wrap; padding:12px 16px; background:#121536; border-top:1px solid #272a55 }
    .legend .item{ display:inline-flex; align-items:center; gap:8px; color:var(--muted); font-size:13px }
    .dot{ width:18px; height:18px; border-radius:6px; background:var(--seat); border:1px solid #303463 }
    .dot.sel{ background:var(--accent); border-color:transparent; box-shadow:0 0 0 3px var(--seat-selected) inset }
    .dot.occ{ background:var(--danger) }
    .dot.res{ background:var(--warning) }
    .dot.prem{ background:#8de0ff; }

    .toolbar{ display:flex; gap:10px; align-items:center; justify-content:space-between; padding:14px 16px; background:#121536; border-top:1px solid #272a55 }
    .price{ font-weight:700 }

    .btn{ appearance:none; border:none; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer; color:#0b1029; background:var(--accent); transition:transform .08s ease, filter .2s ease }
    .btn:hover{ transform: translateY(-1px) }
    .btn.secondary{ background:#2a2f61; color:#cdd3ff }
    .btn.danger{ background:var(--danger); color:#2a0d10 }
    .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none }

    /* Seating grid */
    .auditorium{ padding:8px 10px 24px; }
    .row{ display:grid; grid-template-columns:auto var(--gap) repeat(var(--cols), minmax(28px, 40px)); align-items:center; gap:6px; margin:6px 0; }
    .row-label{ color:#b7bbee; font-weight:700; text-align:center; position:sticky; left:10px; }

    .seats{ display:grid; grid-template-columns: repeat(var(--cols), minmax(28px, 40px)); gap:8px; }
    .seat{ --size: clamp(26px, 2.4vw, 38px); width:var(--size); height:calc(var(--size) * .9); border-radius:8px; background:var(--seat); border:1px solid #303463; display:grid; place-items:center; font-size:12px; color:#a9aed8; user-select:none; cursor:pointer; position:relative; outline:none }
    .seat:hover{ background:var(--seat-hover) }
    .seat[data-type="premium"]{ background: linear-gradient(180deg, #203a6d, #1a254e); }
    .seat.selected{ border-color:transparent; box-shadow:inset 0 0 0 3px var(--seat-selected), 0 0 0 2px #99a7ff55 }
    .seat.occupied{ background:var(--danger); color:#2a0d10; cursor:not-allowed; filter:saturate(90%) }
    .seat.reserved{ background:var(--warning); color:#3b2b04; cursor:not-allowed }

    .aisle{ width:var(--gap); }

    .sr-only{ position:absolute; width:1px; height:1px; margin:-1px; border:0; padding:0; overflow:hidden; clip:rect(0 0 0 0) }

    @media (max-width:680px){
      .row{ grid-template-columns:auto var(--gap) 1fr }
      .seats{ grid-template-columns: repeat(var(--cols), minmax(22px, 1fr)); gap:6px }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">🎬 Movie Seating</div>
        <div class="sub" id="showMeta">Choose your seats</div>
      </div>
      <div>
        <label class="sub" for="showSelect">Showtime:</label>
        <select id="showSelect" aria-label="Select showtime">
          <option value="2025-09-20T19:30">Sat, Sep 20 · 7:30 PM</option>
          <option value="2025-09-21T16:30">Sun, Sep 21 · 4:30 PM</option>
          <option value="2025-09-21T20:15">Sun, Sep 21 · 8:15 PM</option>
        </select>
      </div>
    </header>

    <section class="panel grid-wrap" aria-labelledby="screenLabel">
      <div class="screen" role="img" aria-labelledby="screenLabel"></div>
      <div id="screenLabel" class="screen-label">SCREEN</div>

      <div id="auditorium" class="auditorium" role="grid" aria-label="Seating chart" aria-describedby="legendText"></div>

      <div class="legend" id="legendText">
        <span class="item"><span class="dot"></span> Available</span>
        <span class="item"><span class="dot sel"></span> Selected</span>
        <span class="item"><span class="dot occ"></span> Occupied</span>
        <span class="item"><span class="dot res"></span> Reserved</span>
        <span class="item"><span class="dot prem"></span> Premium</span>
      </div>

      <div class="toolbar">
        <div>
          <span class="sub">Selected: </span>
          <span id="selectedCount" class="price">0</span>
          <span class="sub"> · Total: </span>
          <span id="totalPrice" class="price">$0.00</span>
        </div>
        <div>
          <button id="clearBtn" class="btn secondary" type="button">Clear</button>
          <button id="checkoutBtn" class="btn" type="button">Checkout</button>
        </div>
      </div>
    </section>
  </div>

  <template id="rowTemplate">
    <div class="row" role="row">
      <div class="row-label" role="rowheader"></div>
      <div class="aisle" aria-hidden="true"></div>
      <div class="seats" role="gridcell"></div>
    </div>
  </template>

  <script>
    /**
     * Minimal, accessible seating picker
     * - Build grid from config
     * - Persist selection per showtime in localStorage
     * - Price tiers by seat type
     */

    const config = {
      rows: 10, // A-J
      cols: 12, // 1-12
      aisleAfterCol: 6, // visual gap after this column
      maxPerOrder: 6,
      pricing: {
        standard: 12.5,
        premium: 16.0,
      },
      premiumRows: [4,5,6], // 1-indexed rows (D-F)
      // Fake occupied/reserved seats per showtime (ISO string)
      holds: {
        "2025-09-20T19:30": { occupied: ["A-3","A-4","C-8","F-7","J-12"], reserved: ["E-5","E-6","F-5"] },
        "2025-09-21T16:30": { occupied: ["B-2","D-10","H-1","H-2"], reserved: ["E-6","E-7"] },
        "2025-09-21T20:15": { occupied: ["A-1","A-2","G-6","I-9"], reserved: ["F-6"] },
      }
    };

    const auditorium = document.getElementById('auditorium');
    const showSelect = document.getElementById('showSelect');
    const selectedCount = document.getElementById('selectedCount');
    const totalPrice = document.getElementById('totalPrice');
    const clearBtn = document.getElementById('clearBtn');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const rowTpl = document.getElementById('rowTemplate');
    const showMeta = document.getElementById('showMeta');

    // Utilities
    const rowLetter = (i) => String.fromCharCode('A'.charCodeAt(0) + i);
    const seatId = (r, c) => `${rowLetter(r)}-${c+1}`;

    function isPremium(rowIdx){
      const humanRow = rowIdx + 1;
      return config.premiumRows.includes(humanRow);
    }

    function getSeatType(rowIdx){ return isPremium(rowIdx) ? 'premium' : 'standard'; }

    function getPriceForSeat(rowIdx){
      const type = getSeatType(rowIdx);
      return config.pricing[type];
    }

    function formatUSD(n){ return n.toLocaleString(undefined, { style:'currency', currency:'USD' }); }

    function currentShowKey(){ return showSelect.value; }

    function loadSelection(){
      const raw = localStorage.getItem('seats::' + currentShowKey()) || '[]';
      try{ return JSON.parse(raw); }catch{ return []; }
    }

    function saveSelection(ids){
      localStorage.setItem('seats::' + currentShowKey(), JSON.stringify(ids));
    }

    function updateSummary(){
      const selected = [...auditorium.querySelectorAll('.seat.selected')];
      selectedCount.textContent = selected.length;
      const total = selected.reduce((sum, el) => sum + Number(el.dataset.price), 0);
      totalPrice.textContent = formatUSD(total);
    }

    function getHolds(){
      return config.holds[currentShowKey()] || { occupied:[], reserved:[] };
    }

    function buildGrid(){
      auditorium.innerHTML = '';
      auditorium.style.setProperty('--cols', config.cols);

      const { occupied, reserved } = getHolds();
      const selectedIds = new Set(loadSelection());

      for(let r=0; r<config.rows; r++){
        const rowEl = rowTpl.content.firstElementChild.cloneNode(true);
        const label = rowEl.querySelector('.row-label');
        const seatsEl = rowEl.querySelector('.seats');

        label.textContent = rowLetter(r);

        // Build seats
        for(let c=0; c<config.cols; c++){
          const id = seatId(r, c);
          const seat = document.createElement('button');
          seat.className = 'seat';
          seat.type = 'button';
          seat.dataset.id = id;
          const type = getSeatType(r);
          seat.dataset.type = type;
          seat.dataset.price = getPriceForSeat(r);
          seat.setAttribute('aria-label', `Seat ${id}, ${type} ${formatUSD(Number(seat.dataset.price))}`);
          seat.setAttribute('aria-pressed', 'false');
          seat.title = `${id}`;

          // Visual number (hide on very small screens via CSS if desired)
          seat.textContent = c+1;

          // Status
          if(occupied.includes(id)) seat.classList.add('occupied');
          if(reserved.includes(id)) seat.classList.add('reserved');
          if(type === 'premium') seat.classList.add('premium');
          if(selectedIds.has(id)) seat.classList.add('selected');

          // Aisle gap via margin after aisleAfterCol
          if(c === config.aisleAfterCol - 1){
            seat.style.marginRight = 'var(--gap)';
          }

          seat.addEventListener('click', () => toggleSeat(seat));
          seat.addEventListener('keydown', e => seatKeyNav(e, r, c));

          seatsEl.appendChild(seat);
        }
        auditorium.appendChild(rowEl);
      }

      updateSummary();
      showMeta.textContent = `Choose your seats · ${new Date(currentShowKey()).toLocaleString([], { dateStyle:'medium', timeStyle:'short' })}`;
    }

    function toggleSeat(el){
      if(el.classList.contains('occupied') || el.classList.contains('reserved')) return;
      const currentSelected = auditorium.querySelectorAll('.seat.selected').length;
      if(!el.classList.contains('selected') && currentSelected >= config.maxPerOrder){
        pulse(el);
        toast(`Limit of ${config.maxPerOrder} seats per order`);
        return;
      }
      el.classList.toggle('selected');
      el.setAttribute('aria-pressed', String(el.classList.contains('selected')));
      const ids = [...auditorium.querySelectorAll('.seat.selected')].map(x=>x.dataset.id);
      saveSelection(ids);
      updateSummary();
    }

    function seatKeyNav(e, r, c){
      const key = e.key;
      const idx = r * config.cols + c;

      const seats = [...auditorium.querySelectorAll('.seat')];
      const go = (nr, nc) => {
        const pos = nr * config.cols + nc;
        seats[pos]?.focus();
      }
      if(['ArrowLeft','ArrowRight','ArrowUp','ArrowDown',' '].includes(key)) e.preventDefault();
      if(key === ' ' || key === 'Enter') e.currentTarget.click();
      if(key === 'ArrowLeft' && c>0) go(r, c-1);
      if(key === 'ArrowRight' && c<config.cols-1) go(r, c+1);
      if(key === 'ArrowUp' && r>0) go(r-1, c);
      if(key === 'ArrowDown' && r<config.rows-1) go(r+1, c);
    }

    function pulse(el){
      el.animate([{ transform:'scale(1)' }, { transform:'scale(.96)' }, { transform:'scale(1)' }], { duration:220, easing:'ease-out' });
    }

    function toast(msg){
      let t = document.getElementById('toast');
      if(!t){
        t = Object.assign(document.createElement('div'), { id:'toast' });
        Object.assign(t.style, {
          position:'fixed', left:'50%', bottom:'22px', transform:'translateX(-50%)',
          background:'#1e2350', color:'var(--text)', border:'1px solid #313769', padding:'10px 14px', borderRadius:'12px',
          boxShadow:'0 8px 24px #0008', zIndex:999
        });
        document.body.appendChild(t);
      }
      t.textContent = msg;
      t.style.opacity = '1';
      clearTimeout(t._timer);
      t._timer = setTimeout(()=> t.style.opacity = '0', 1700);
    }

    // Controls
    clearBtn.addEventListener('click', () => {
      saveSelection([]);
      auditorium.querySelectorAll('.seat.selected').forEach(s => s.classList.remove('selected'));
      updateSummary();
    });

    checkoutBtn.addEventListener('click', () => {
      const seats = [...auditorium.querySelectorAll('.seat.selected')];
      if(!seats.length){ toast('Pick at least one seat'); return; }
      const ids = seats.map(s => s.dataset.id).join(', ');
      const total = totalPrice.textContent;
      alert(`Checkout\n\nShowtime: ${new Date(currentShowKey()).toLocaleString()}\nSeats: ${ids}\nTotal: ${total}\n\n(Implement real checkout here)`);
    });

    showSelect.addEventListener('change', () => buildGrid());

    // Initialize with URL ?show=ISO
    const url = new URL(location.href);
    const showParam = url.searchParams.get('show');
    if(showParam){
      const opt = [...showSelect.options].find(o => o.value === showParam);
      if(opt) showSelect.value = showParam;
    }

    buildGrid();
  </script>
</body>
</html>
